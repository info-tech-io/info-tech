# –≠—Ç–∞–ø 7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## –®–∞–≥ 7.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã InfoTech.io

### –ü–æ–¥—à–∞–≥ 7.1.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UptimeRobot –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤ –≤ UptimeRobot:**
```
1. –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç:
   - URL: https://infotecha.ru
   - –¢–∏–ø: HTTPS
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 5 –º–∏–Ω—É—Ç
   - Keyword monitoring: "InfoTech.io"

2. API —Å—Ç–∞—Ç—É—Å (modules.json):
   - URL: https://infotecha.ru/modules.json  
   - –¢–∏–ø: HTTPS
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 10 –º–∏–Ω—É—Ç
   - Response time threshold: 3 —Å–µ–∫—É–Ω–¥—ã

3. –¢–µ—Å—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å:
   - URL: https://test-module.infotecha.ru
   - –¢–∏–ø: HTTPS
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 15 –º–∏–Ω—É—Ç
   - Keyword monitoring: "–¢–µ—Å—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å"

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- Email: admin@infotecha.ru
- Telegram (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- Webhook –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
```

### –ü–æ–¥—à–∞–≥ 7.1.2: –õ–æ–∫–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo tee /opt/infotecha/scripts/system-monitor.sh > /dev/null << 'EOF'
#!/bin/bash

# InfoTech.io System Monitor
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOG_FILE="/var/www/infotecha.ru/logs/system-monitor.log"
STATUS_FILE="/opt/infotecha/status.json"
WEBROOT="/var/www/infotecha.ru"

# Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–∑–∂–µ)
ADMIN_EMAIL="admin@infotecha.ru"
ALERT_WEBHOOK=""  # URL –¥–ª—è webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

# –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
DISK_THRESHOLD=80      # –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞
MEMORY_THRESHOLD=85    # –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
LOAD_THRESHOLD=2.0     # –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
RESPONSE_TIME_THRESHOLD=3000  # –º—Å

# Logging function
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Function: Check disk usage
check_disk_usage() {
    local usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    
    if [ "$usage" -gt "$DISK_THRESHOLD" ]; then
        log "‚ö†Ô∏è WARNING: Disk usage is ${usage}% (threshold: ${DISK_THRESHOLD}%)"
        return 1
    else
        log "‚úÖ Disk usage: ${usage}% (OK)"
        return 0
    fi
}

# Function: Check memory usage
check_memory_usage() {
    local memory_usage=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100}')
    
    if [ "$memory_usage" -gt "$MEMORY_THRESHOLD" ]; then
        log "‚ö†Ô∏è WARNING: Memory usage is ${memory_usage}% (threshold: ${MEMORY_THRESHOLD}%)"
        return 1
    else
        log "‚úÖ Memory usage: ${memory_usage}% (OK)"
        return 0
    fi
}

# Function: Check system load
check_system_load() {
    local load_1min=$(uptime | awk '{print $(NF-2)}' | sed 's/,//')
    local load_threshold_int=$(echo "$LOAD_THRESHOLD * 100" | bc | cut -d. -f1)
    local load_1min_int=$(echo "$load_1min * 100" | bc | cut -d. -f1)
    
    if [ "$load_1min_int" -gt "$load_threshold_int" ]; then
        log "‚ö†Ô∏è WARNING: System load is ${load_1min} (threshold: ${LOAD_THRESHOLD})"
        return 1
    else
        log "‚úÖ System load: ${load_1min} (OK)"
        return 0
    fi
}

# Function: Check Apache status  
check_apache_status() {
    if systemctl is-active apache2 >/dev/null 2>&1; then
        log "‚úÖ Apache is running"
        return 0
    else
        log "‚ùå CRITICAL: Apache is not running"
        return 1
    fi
}

# Function: Check website response time
check_website_response() {
    local url="https://infotecha.ru"
    local response_time=$(curl -o /dev/null -s -w '%{time_total}' "$url" | awk '{print int($1*1000)}')
    
    if [ "$response_time" -gt "$RESPONSE_TIME_THRESHOLD" ]; then
        log "‚ö†Ô∏è WARNING: Website response time is ${response_time}ms (threshold: ${RESPONSE_TIME_THRESHOLD}ms)"
        return 1
    else
        log "‚úÖ Website response time: ${response_time}ms (OK)"
        return 0
    fi
}

# Function: Check SSL certificate expiration
check_ssl_certificate() {
    local domain="infotecha.ru"
    local expiry_date=$(echo | openssl s_client -servername "$domain" -connect "$domain":443 2>/dev/null | openssl x509 -noout -enddate | cut -d= -f2)
    local expiry_epoch=$(date -d "$expiry_date" +%s)
    local current_epoch=$(date +%s)
    local days_until_expiry=$(( (expiry_epoch - current_epoch) / 86400 ))
    
    if [ "$days_until_expiry" -lt 30 ]; then
        log "‚ö†Ô∏è WARNING: SSL certificate expires in ${days_until_expiry} days"
        return 1
    else
        log "‚úÖ SSL certificate: ${days_until_expiry} days until expiry (OK)"
        return 0
    fi
}

# Function: Check disk space for logs
check_log_disk_space() {
    local log_dir="/var/www/infotecha.ru/logs"
    local log_size=$(du -sh "$log_dir" | cut -f1)
    local log_size_bytes=$(du -s "$log_dir" | cut -f1)
    
    # –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤ –±–æ–ª—å—à–µ 100MB
    if [ "$log_size_bytes" -gt 102400 ]; then
        log "‚ö†Ô∏è WARNING: Log directory size is ${log_size} (consider cleanup)"
        return 1
    else
        log "‚úÖ Log directory size: ${log_size} (OK)"
        return 0
    fi
}

# Function: Generate status report
generate_status_report() {
    local timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
    local hostname=$(hostname)
    local uptime=$(uptime -p)
    
    # System stats
    local disk_usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    local memory_usage=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100}')
    local load_1min=$(uptime | awk '{print $(NF-2)}' | sed 's/,//')
    local apache_status=$(systemctl is-active apache2)
    
    # Create JSON status report
    cat > "$STATUS_FILE" << JSON
{
  "timestamp": "$timestamp",
  "hostname": "$hostname", 
  "uptime": "$uptime",
  "status": "healthy",
  "metrics": {
    "disk_usage_percent": $disk_usage,
    "memory_usage_percent": $memory_usage,
    "load_average_1min": $load_1min,
    "apache_status": "$apache_status"
  },
  "services": {
    "apache": "$apache_status",
    "ssl_cert_valid": true
  },
  "last_check": "$timestamp"
}
JSON

    log "üìä Status report generated: $STATUS_FILE"
}

# Function: Send alert (placeholder for future integration)
send_alert() {
    local alert_type="$1"
    local message="$2"
    
    log "üö® ALERT [$alert_type]: $message"
    
    # TODO: Implement email/webhook notifications
    # echo "$message" | mail -s "InfoTech.io Alert: $alert_type" "$ADMIN_EMAIL"
    
    # Webhook notification (if configured)
    if [ -n "$ALERT_WEBHOOK" ]; then
        curl -s -X POST "$ALERT_WEBHOOK" \
            -H "Content-Type: application/json" \
            -d "{\"alert_type\":\"$alert_type\",\"message\":\"$message\",\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" \
            > /dev/null 2>&1 || true
    fi
}

# Main monitoring function
run_monitoring() {
    log "üîç Starting system monitoring check..."
    
    local issues=0
    local warnings=0
    
    # Run all checks
    check_disk_usage || ((issues++))
    check_memory_usage || ((warnings++))  
    check_system_load || ((warnings++))
    check_apache_status || ((issues++))
    check_website_response || ((warnings++))
    check_ssl_certificate || ((warnings++))
    check_log_disk_space || ((warnings++))
    
    # Generate status report
    generate_status_report
    
    # Summary
    if [ "$issues" -gt 0 ]; then
        log "‚ùå CRITICAL: $issues critical issues found"
        send_alert "CRITICAL" "$issues critical issues detected on InfoTech.io platform"
        return 1
    elif [ "$warnings" -gt 0 ]; then
        log "‚ö†Ô∏è WARNING: $warnings warnings found"
        send_alert "WARNING" "$warnings warnings detected on InfoTech.io platform"
        return 2
    else
        log "‚úÖ All checks passed - system is healthy"
        return 0
    fi
}

# Cleanup old logs (keep last 30 days)
cleanup_old_logs() {
    log "üßπ Cleaning up old log files..."
    
    # Clean system monitor logs
    find "$LOG_FILE" -mtime +30 -delete 2>/dev/null || true
    
    # Clean Apache logs (rotate if too large)
    if [ -f "/var/www/infotecha.ru/logs/access.log" ]; then
        local access_log_size=$(stat -f%z "/var/www/infotecha.ru/logs/access.log" 2>/dev/null || stat -c%s "/var/www/infotecha.ru/logs/access.log")
        if [ "$access_log_size" -gt 10485760 ]; then  # 10MB
            gzip "/var/www/infotecha.ru/logs/access.log"
            mv "/var/www/infotecha.ru/logs/access.log.gz" "/var/www/infotecha.ru/logs/access.log.$(date +%Y%m%d).gz"
            systemctl reload apache2
            log "üì¶ Apache access log rotated"
        fi
    fi
    
    log "‚úÖ Cleanup completed"
}

# Command line interface
case "${1:-monitor}" in
    "monitor")
        run_monitoring
        ;;
    "cleanup")
        cleanup_old_logs
        ;;
    "status")
        if [ -f "$STATUS_FILE" ]; then
            cat "$STATUS_FILE" | jq '.' 2>/dev/null || cat "$STATUS_FILE"
        else
            echo "No status file found. Run monitoring first."
        fi
        ;;
    *)
        echo "Usage: $0 [monitor|cleanup|status]"
        echo ""
        echo "Commands:"
        echo "  monitor  - Run system monitoring checks (default)"
        echo "  cleanup  - Clean up old log files"
        echo "  status   - Show last status report"
        exit 1
        ;;
esac
EOF

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo chmod +x /opt/infotecha/scripts/system-monitor.sh
sudo chown deploy-user:deploy-user /opt/infotecha/scripts/system-monitor.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ bc –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
sudo apt-get install -y bc jq

# –°–æ–∑–¥–∞–Ω–∏–µ cron –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
echo "# InfoTech.io System Monitoring
# Runs every 15 minutes
*/15 * * * * /opt/infotecha/scripts/system-monitor.sh monitor

# Log cleanup runs daily at 2 AM
0 2 * * * /opt/infotecha/scripts/system-monitor.sh cleanup" | sudo crontab -u deploy-user -
```

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```bash
# –¢–µ—Å—Ç —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo /opt/infotecha/scripts/system-monitor.sh monitor

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo /opt/infotecha/scripts/system-monitor.sh status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞—á
sudo crontab -u deploy-user -l

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
tail -10 /var/www/infotecha.ru/logs/system-monitor.log
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ UptimeRobot –º–æ–Ω–∏—Ç–æ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Cron –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

---

## –®–∞–≥ 7.2: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥—à–∞–≥ 7.2.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –±—ç–∫–∞–ø–æ–≤

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
sudo tee /opt/infotecha/scripts/backup.sh > /dev/null << 'EOF'
#!/bin/bash

# InfoTech.io Backup Script
# –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BACKUP_ROOT="/var/www/infotecha.ru/backups"
WEBROOT="/var/www/infotecha.ru"
LOG_FILE="/var/www/infotecha.ru/logs/backup.log"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BACKUP_RETENTION_DAYS=30
REMOTE_BACKUP_ENABLED=false
REMOTE_BACKUP_HOST=""
REMOTE_BACKUP_USER=""
REMOTE_BACKUP_PATH=""

# Logging function
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Function: Create local backup
create_backup() {
    local backup_type="${1:-full}"
    local timestamp=$(date +"%Y%m%d_%H%M%S")
    local backup_dir="$BACKUP_ROOT/$backup_type/$timestamp"
    
    log "üéí Starting $backup_type backup..."
    
    # Create backup directory
    mkdir -p "$backup_dir"
    
    case "$backup_type" in
        "full")
            create_full_backup "$backup_dir"
            ;;
        "config")
            create_config_backup "$backup_dir"
            ;;
        "content")
            create_content_backup "$backup_dir"
            ;;
        *)
            log "‚ùå Unknown backup type: $backup_type"
            return 1
            ;;
    esac
    
    # Compress backup
    log "üì¶ Compressing backup..."
    cd "$(dirname "$backup_dir")"
    tar -czf "${timestamp}.tar.gz" "$(basename "$backup_dir")"
    rm -rf "$backup_dir"
    
    local backup_size=$(du -h "${timestamp}.tar.gz" | cut -f1)
    log "‚úÖ Backup completed: ${timestamp}.tar.gz (${backup_size})"
    
    # Cleanup old backups
    cleanup_old_backups "$backup_type"
}

# Function: Create full backup
create_full_backup() {
    local backup_dir="$1"
    
    log "üìÅ Creating full backup..."
    
    # Backup web content
    mkdir -p "$backup_dir/web"
    cp -r "$WEBROOT"/*.html "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/*.css "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/*.js "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/modules.json "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/images "$backup_dir/web/" 2>/dev/null || true
    
    # Backup modules
    mkdir -p "$backup_dir/modules"
    for module_dir in "$WEBROOT"/*/; do
        if [ -d "$module_dir" ] && [ "$(basename "$module_dir")" != "logs" ] && [ "$(basename "$module_dir")" != "backups" ]; then
            cp -r "$module_dir" "$backup_dir/modules/"
        fi
    done
    
    # Backup configuration
    mkdir -p "$backup_dir/config"
    cp -r /etc/apache2/sites-available/infotecha.conf "$backup_dir/config/" 2>/dev/null || true
    cp -r /opt/infotecha/scripts "$backup_dir/config/" 2>/dev/null || true
    cp -r /etc/letsencrypt/live/infotecha.ru "$backup_dir/config/" 2>/dev/null || true
    
    # Backup logs (last 7 days)
    mkdir -p "$backup_dir/logs"
    find "$WEBROOT/logs" -name "*.log" -mtime -7 -exec cp {} "$backup_dir/logs/" \; 2>/dev/null || true
    
    # Create backup manifest
    cat > "$backup_dir/manifest.json" << JSON
{
  "backup_type": "full",
  "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "hostname": "$(hostname)",
  "platform_version": "1.0.0",
  "includes": [
    "web content (HTML, CSS, JS)",
    "modules.json registry",
    "all modules",
    "Apache configuration",
    "SSL certificates",
    "recent logs (7 days)",
    "backup scripts"
  ],
  "total_size_bytes": $(du -sb "$backup_dir" | cut -f1)
}
JSON
    
    log "üìã Full backup manifest created"
}

# Function: Create config-only backup
create_config_backup() {
    local backup_dir="$1"
    
    log "‚öôÔ∏è Creating configuration backup..."
    
    mkdir -p "$backup_dir/config"
    
    # Apache configuration
    cp -r /etc/apache2/sites-available/infotecha.conf "$backup_dir/config/" 2>/dev/null || true
    
    # Platform scripts and configurations
    cp -r /opt/infotecha "$backup_dir/config/" 2>/dev/null || true
    
    # modules.json
    cp "$WEBROOT/modules.json" "$backup_dir/config/" 2>/dev/null || true
    
    # SSL certificates
    mkdir -p "$backup_dir/ssl"
    cp -r /etc/letsencrypt/live/infotecha.ru "$backup_dir/ssl/" 2>/dev/null || true
    
    # Create manifest
    cat > "$backup_dir/manifest.json" << JSON
{
  "backup_type": "config",
  "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "hostname": "$(hostname)",
  "includes": [
    "Apache VirtualHost configuration",
    "Platform scripts",
    "modules.json registry",
    "SSL certificates"
  ]
}
JSON
    
    log "üìã Configuration backup manifest created"
}

# Function: Create content-only backup
create_content_backup() {
    local backup_dir="$1"
    
    log "üìÑ Creating content backup..."
    
    # Web content
    mkdir -p "$backup_dir/web"
    cp -r "$WEBROOT"/*.html "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/*.css "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/*.js "$backup_dir/web/" 2>/dev/null || true
    cp -r "$WEBROOT"/images "$backup_dir/web/" 2>/dev/null || true
    
    # modules.json
    cp "$WEBROOT/modules.json" "$backup_dir/web/" 2>/dev/null || true
    
    # All modules
    mkdir -p "$backup_dir/modules"
    for module_dir in "$WEBROOT"/*/; do
        if [ -d "$module_dir" ] && [ "$(basename "$module_dir")" != "logs" ] && [ "$(basename "$module_dir")" != "backups" ]; then
            cp -r "$module_dir" "$backup_dir/modules/"
        fi
    done
    
    # Create manifest
    cat > "$backup_dir/manifest.json" << JSON
{
  "backup_type": "content",
  "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "hostname": "$(hostname)",
  "includes": [
    "Main website content",
    "All learning modules",
    "modules.json registry",
    "Static assets (images, etc.)"
  ]
}
JSON
    
    log "üìã Content backup manifest created"
}

# Function: Cleanup old backups
cleanup_old_backups() {
    local backup_type="$1"
    local backup_type_dir="$BACKUP_ROOT/$backup_type"
    
    if [ -d "$backup_type_dir" ]; then
        log "üßπ Cleaning up old $backup_type backups (keeping last $BACKUP_RETENTION_DAYS days)..."
        
        find "$backup_type_dir" -name "*.tar.gz" -mtime +$BACKUP_RETENTION_DAYS -delete
        find "$backup_type_dir" -type d -empty -delete
        
        local remaining_backups=$(find "$backup_type_dir" -name "*.tar.gz" | wc -l)
        log "üì¶ $remaining_backups $backup_type backups remaining"
    fi
}

# Function: List available backups
list_backups() {
    log "üìã Available backups:"
    
    for backup_type in full config content; do
        local backup_type_dir="$BACKUP_ROOT/$backup_type"
        if [ -d "$backup_type_dir" ]; then
            echo ""
            echo "$backup_type backups:"
            echo "$(printf '%-20s %-15s %s' 'Timestamp' 'Size' 'Age')"
            echo "$(printf '%-20s %-15s %s' '---' '---' '---')"
            
            find "$backup_type_dir" -name "*.tar.gz" -printf '%f %s %T@\n' | sort -k3nr | while read filename size timestamp; do
                local readable_size=$(numfmt --to=iec "$size")
                local age_days=$(( ($(date +%s) - ${timestamp%.*}) / 86400 ))
                local clean_filename=$(echo "$filename" | sed 's/.tar.gz$//')
                printf '%-20s %-15s %s days\n' "$clean_filename" "$readable_size" "$age_days"
            done
        fi
    done
}

# Function: Restore from backup
restore_backup() {
    local backup_file="$1"
    local restore_type="${2:-dry-run}"
    
    if [ ! -f "$backup_file" ]; then
        log "‚ùå Backup file not found: $backup_file"
        return 1
    fi
    
    log "üîÑ Starting restore from: $backup_file"
    
    # Extract to temporary location
    local temp_dir="/tmp/infotecha-restore-$$"
    mkdir -p "$temp_dir"
    
    cd "$temp_dir"
    tar -xzf "$backup_file"
    
    # Find extracted directory
    local extracted_dir=$(find . -maxdepth 1 -type d -name "*_*" | head -1)
    if [ -z "$extracted_dir" ]; then
        log "‚ùå Could not find extracted backup directory"
        rm -rf "$temp_dir"
        return 1
    fi
    
    # Show manifest
    if [ -f "$extracted_dir/manifest.json" ]; then
        log "üìã Backup manifest:"
        cat "$extracted_dir/manifest.json" | jq '.' 2>/dev/null || cat "$extracted_dir/manifest.json"
    fi
    
    if [ "$restore_type" = "dry-run" ]; then
        log "üîç DRY RUN - Files that would be restored:"
        find "$extracted_dir" -type f | head -20
        log "... (showing first 20 files)"
    else
        log "‚ö†Ô∏è ACTUAL RESTORE - This will overwrite current files!"
        read -p "Continue? (yes/no): " confirm
        if [ "$confirm" = "yes" ]; then
            # Perform actual restore
            log "üöÄ Restoring files..."
            
            # Create backup of current state before restore
            create_backup "pre-restore"
            
            # Restore files (implement specific restore logic based on backup type)
            if [ -d "$extracted_dir/web" ]; then
                cp -r "$extracted_dir/web"/* "$WEBROOT/"
            fi
            
            # Set permissions
            chown -R www-data:www-data "$WEBROOT"
            systemctl reload apache2
            
            log "‚úÖ Restore completed"
        else
            log "‚ùå Restore cancelled"
        fi
    fi
    
    # Cleanup
    rm -rf "$temp_dir"
}

# Function: Upload to remote backup (if configured)
upload_remote_backup() {
    if [ "$REMOTE_BACKUP_ENABLED" = "true" ] && [ -n "$REMOTE_BACKUP_HOST" ]; then
        log "‚òÅÔ∏è Uploading to remote backup location..."
        
        # Upload latest backups via rsync
        rsync -avz --delete "$BACKUP_ROOT/" "${REMOTE_BACKUP_USER}@${REMOTE_BACKUP_HOST}:${REMOTE_BACKUP_PATH}/" \
            && log "‚úÖ Remote backup upload completed" \
            || log "‚ùå Remote backup upload failed"
    fi
}

# Main script logic
case "${1:-full}" in
    "full"|"config"|"content")
        create_backup "$1"
        upload_remote_backup
        ;;
    "list")
        list_backups
        ;;
    "restore")
        if [ -z "$2" ]; then
            echo "Usage: $0 restore <backup_file.tar.gz> [dry-run|execute]"
            exit 1
        fi
        restore_backup "$2" "${3:-dry-run}"
        ;;
    "cleanup")
        for backup_type in full config content; do
            cleanup_old_backups "$backup_type"
        done
        ;;
    *)
        echo "InfoTech.io Backup Script"
        echo "Usage: $0 [full|config|content|list|restore|cleanup]"
        echo ""
        echo "Commands:"
        echo "  full     - Create full backup (default)"
        echo "  config   - Create configuration-only backup"
        echo "  content  - Create content-only backup"
        echo "  list     - List available backups"
        echo "  restore  - Restore from backup"
        echo "  cleanup  - Remove old backups"
        echo ""
        echo "Examples:"
        echo "  $0 full"
        echo "  $0 list"
        echo "  $0 restore /path/to/backup.tar.gz dry-run"
        exit 1
        ;;
esac
EOF

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
sudo chmod +x /opt/infotecha/scripts/backup.sh
sudo chown deploy-user:deploy-user /opt/infotecha/scripts/backup.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
echo "# InfoTech.io Backup Schedule
# Full backup daily at 1 AM
0 1 * * * /opt/infotecha/scripts/backup.sh full

# Configuration backup every 6 hours
0 */6 * * * /opt/infotecha/scripts/backup.sh config

# Content backup every 2 hours  
0 */2 * * * /opt/infotecha/scripts/backup.sh content" | sudo crontab -u deploy-user -
```

### –ü–æ–¥—à–∞–≥ 7.2.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –±—ç–∫–∞–ø–æ–≤

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤:**
```bash
sudo tee /opt/infotecha/scripts/test-backup.sh > /dev/null << 'EOF'
#!/bin/bash

# InfoTech.io Backup Testing Script

echo "üß™ Testing InfoTech.io Backup System"
echo "===================================="

# Create test content for backup
echo "üìù Creating test content..."
TEST_FILE="/var/www/infotecha.ru/backup-test-$(date +%s).html"
echo "<h1>Backup Test - $(date)</h1>" | sudo tee "$TEST_FILE" > /dev/null
sudo chown www-data:www-data "$TEST_FILE"

# Test configuration backup
echo ""
echo "‚öôÔ∏è Testing configuration backup..."
/opt/infotecha/scripts/backup.sh config
CONFIG_BACKUP=$(find /var/www/infotecha.ru/backups/config -name "*.tar.gz" -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)

if [ -f "$CONFIG_BACKUP" ]; then
    echo "‚úÖ Configuration backup created: $CONFIG_BACKUP"
    
    # Test extraction
    TEMP_DIR="/tmp/backup-test-$$"
    mkdir -p "$TEMP_DIR"
    cd "$TEMP_DIR"
    tar -xzf "$CONFIG_BACKUP" > /dev/null 2>&1
    
    if [ -f */manifest.json ]; then
        echo "‚úÖ Backup manifest found"
        echo "üìã Backup contents:"
        find . -type f | head -10
    else
        echo "‚ùå Backup manifest missing"
    fi
    
    rm -rf "$TEMP_DIR"
else
    echo "‚ùå Configuration backup failed"
fi

# Test content backup
echo ""
echo "üìÑ Testing content backup..."
/opt/infotecha/scripts/backup.sh content
CONTENT_BACKUP=$(find /var/www/infotecha.ru/backups/content -name "*.tar.gz" -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)

if [ -f "$CONTENT_BACKUP" ]; then
    echo "‚úÖ Content backup created: $CONTENT_BACKUP"
    
    # Check if test file is included
    TEMP_DIR="/tmp/backup-test-$$"
    mkdir -p "$TEMP_DIR"
    cd "$TEMP_DIR"
    tar -xzf "$CONTENT_BACKUP" > /dev/null 2>&1
    
    if find . -name "backup-test-*.html" | grep -q .; then
        echo "‚úÖ Test file found in backup"
    else
        echo "‚ùå Test file missing from backup"
    fi
    
    rm -rf "$TEMP_DIR"
else
    echo "‚ùå Content backup failed"
fi

# Test backup listing
echo ""
echo "üìã Testing backup listing..."
/opt/infotecha/scripts/backup.sh list | head -20

# Cleanup test file
sudo rm -f "$TEST_FILE"

# Test restore (dry run)
if [ -f "$CONTENT_BACKUP" ]; then
    echo ""
    echo "üîÑ Testing restore (dry run)..."
    /opt/infotecha/scripts/backup.sh restore "$CONTENT_BACKUP" dry-run | head -10
fi

echo ""
echo "üéâ Backup system testing completed!"
EOF

sudo chmod +x /opt/infotecha/scripts/test-backup.sh
sudo chown deploy-user:deploy-user /opt/infotecha/scripts/test-backup.sh

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
sudo /opt/infotecha/scripts/test-backup.sh
```

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤
sudo /opt/infotecha/scripts/backup.sh full
sudo /opt/infotecha/scripts/backup.sh list

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞—á
sudo crontab -u deploy-user -l | grep backup

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±—ç–∫–∞–ø–æ–≤
tail -10 /var/www/infotecha.ru/logs/backup.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–ø–∫–∏ –±—ç–∫–∞–ø–æ–≤
du -sh /var/www/infotecha.ru/backups/
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤ —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –®–∞–≥ 7.3: –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–∞—Ö —Å–±–æ–µ–≤

### –ü–æ–¥—à–∞–≥ 7.3.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç –ø–ª–∞–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
sudo tee /opt/infotecha/docs/disaster-recovery-plan.md > /dev/null << 'EOF'
# –ü–ª–∞–Ω –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è InfoTech.io

## –ö–æ–Ω—Ç–∞–∫—Ç—ã —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:**
- Email: admin@infotecha.ru
- Telegram: @infotecha_admin
- –¢–µ–ª–µ—Ñ–æ–Ω: +7-XXX-XXX-XXXX

**–•–æ—Å—Ç–∏–Ω–≥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: [–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞]
- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: [URL]

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–º–µ–Ω–∞:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: [–¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞]
- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: [URL]

## –¢–∏–ø—ã —Å–±–æ–µ–≤ –∏ –¥–µ–π—Å—Ç–≤–∏—è

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π: –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∞–π—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ HTTP/HTTPS –∑–∞–ø—Ä–æ—Å—ã
- SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ
- UptimeRobot –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Down"

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞** —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É** —Å–µ—Ä–≤–µ—Ä–∞
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏** –¥–æ–º–µ–Ω–∞
4. **–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º** –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞

**–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
sudo fsck /dev/sda1

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status apache2
sudo systemctl status cron

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
/opt/infotecha/scripts/backup.sh restore [latest_backup.tar.gz] execute

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
/opt/infotecha/scripts/test-platform.sh
```

**–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** 1-4 —á–∞—Å–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô

### üü† –°–µ—Ä—å–µ–∑–Ω—ã–π —Å–±–æ–π: Apache –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- SSH –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —Å–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
- Apache —Å–µ—Ä–≤–∏—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö Apache

**–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Apache
sudo systemctl status apache2

# 2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart apache2

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo apache2ctl configtest

# 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –±—ç–∫–∞–ø–∞
sudo cp /var/www/infotecha.ru/backups/config/latest/apache-config/infotecha.conf /etc/apache2/sites-available/
sudo systemctl reload apache2

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo tail -100 /var/log/apache2/error.log
sudo tail -100 /var/www/infotecha.ru/logs/error.log
```

**–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** 15-60 –º–∏–Ω—É—Ç
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

### üü° –£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–±–æ–π: –û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–¥–¥–æ–º–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É 404
- –ú–æ–¥—É–ª—å –µ—Å—Ç—å –≤ modules.json –Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω

**–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–æ–¥—É–ª—è
ls -la /var/www/infotecha.ru/[module-name]/

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R www-data:www-data /var/www/infotecha.ru/[module-name]/
sudo chmod -R 755 /var/www/infotecha.ru/[module-name]/

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å –∏–∑ –±—ç–∫–∞–ø–∞
/opt/infotecha/scripts/backup.sh restore [backup-file] execute

# 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –º–æ–¥—É–ª—å —á–µ—Ä–µ–∑ GitHub Actions
# –ó–∞–ø—É—Å—Ç–∏—Ç—å workflow "Build Module" –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ infotecha
```

**–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** 10-30 –º–∏–Ω—É—Ç
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

### üü° SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ
- HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- HTTP —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

**–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot certificates

# 2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å
sudo certbot renew --force-renewal

# 3. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --apache -d infotecha.ru -d "*.infotecha.ru" --non-interactive

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Apache
sudo systemctl reload apache2

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo systemctl status certbot.timer
```

**–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** 5-15 –º–∏–Ω—É—Ç
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

### üü¢ –ú–µ–ª–∫–∏–π —Å–±–æ–π: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞/–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ
- –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/RAM
- –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
htop
df -h
free -h

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã Apache
sudo apache2ctl status
ps aux | grep apache2

# 3. –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ –µ—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω—ã
sudo /opt/infotecha/scripts/backup.sh cleanup
find /var/www/infotecha.ru/logs -name "*.log" -size +10M -delete

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Apache –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
sudo systemctl restart apache2

# 5. –í–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é Apache (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å mod_cache, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å MaxRequestWorkers
```

**–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** 5-10 –º–∏–Ω—É—Ç
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô

## –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
/opt/infotecha/scripts/test-platform.sh

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ URL
curl -I https://infotecha.ru
curl -I https://test-module.infotecha.ru

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å modules.json
curl -s https://infotecha.ru/modules.json | jq '.'

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
tail -50 /var/www/infotecha.ru/logs/error.log
tail -50 /var/log/apache2/error.log
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
cat /var/www/infotecha.ru/modules.json | jq -r '.modules | keys[]' | while read module; do
    subdomain=$(cat /var/www/infotecha.ru/modules.json | jq -r ".modules[\"$module\"].subdomain")
    echo "Testing: https://$subdomain.infotecha.ru"
    curl -I "https://$subdomain.infotecha.ru" | head -1
done

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
echo | openssl s_client -servername infotecha.ru -connect infotecha.ru:443 2>/dev/null | openssl x509 -noout -dates

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
ab -n 100 -c 10 https://infotecha.ru/

# 4. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã
/opt/infotecha/scripts/backup.sh config
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- **UptimeRobot:** https://uptimerobot.com/dashboard
- **Let's Encrypt Status:** https://letsencrypt.status.io/
- **GitHub Status:** https://www.githubstatus.com/

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **Apache Documentation:** https://httpd.apache.org/docs/2.4/
- **Certbot User Guide:** https://certbot.eff.org/docs/
- **InfoTech.io GitHub:** https://github.com/info-tech-io

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
sudo /opt/infotecha/scripts/system-monitor.sh monitor

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
sudo netstat -tulpn | grep :80
sudo netstat -tulpn | grep :443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
df -h
du -sh /var/www/infotecha.ru/*

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ Apache
sudo tail -f /var/log/apache2/access.log
sudo grep "ERROR" /var/www/infotecha.ru/logs/*.log | tail -20
```

## –ñ—É—Ä–Ω–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

–í—Å–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ:
`/opt/infotecha/docs/incident-log.md`

–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏:
```
## –ò–Ω—Ü–∏–¥–µ–Ω—Ç #001
**–î–∞—Ç–∞:** 2025-01-15 14:30 UTC
**–¢–∏–ø:** –°–µ—Ä—å–µ–∑–Ω—ã–π —Å–±–æ–π - Apache –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 45 –º–∏–Ω—É—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
**–î–µ–π—Å—Ç–≤–∏—è:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –±—ç–∫–∞–ø–∞
**–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ CI/CD
```
EOF

# –°–æ–∑–¥–∞–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
sudo mkdir -p /opt/infotecha/docs
sudo touch /opt/infotecha/docs/incident-log.md
sudo chown -R deploy-user:deploy-user /opt/infotecha/docs

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
sudo tee /opt/infotecha/scripts/quick-diagnosis.sh > /dev/null << 'EOF'
#!/bin/bash

# Quick diagnosis script for InfoTech.io platform issues

echo "üîç InfoTech.io Quick Diagnosis"
echo "=============================="
echo "Timestamp: $(date)"
echo ""

# System overview
echo "üíª SYSTEM OVERVIEW"
echo "Hostname: $(hostname)"
echo "Uptime: $(uptime -p)"
echo "Load: $(uptime | awk '{print $(NF-2), $(NF-1), $NF}')"
echo "Memory: $(free -h | awk '/^Mem:/{print $3 "/" $2}')"
echo "Disk: $(df -h / | awk 'NR==2{print $5 " used of " $2}')"
echo ""

# Service status
echo "üîß SERVICE STATUS"
printf "Apache: "
systemctl is-active apache2 && echo "‚úÖ Running" || echo "‚ùå Stopped"

printf "Cron: "
systemctl is-active cron && echo "‚úÖ Running" || echo "‚ùå Stopped"

printf "UFW: "
ufw status | grep -q "Status: active" && echo "‚úÖ Active" || echo "‚ùå Inactive"
echo ""

# Network tests
echo "üåê NETWORK TESTS"
printf "Main site HTTP: "
curl -s -o /dev/null -w '%{http_code}' http://localhost | grep -q '200\|301\|302' && echo "‚úÖ OK" || echo "‚ùå FAIL"

printf "Main site HTTPS: "
curl -s -k -o /dev/null -w '%{http_code}' https://localhost | grep -q '200' && echo "‚úÖ OK" || echo "‚ùå FAIL"

printf "modules.json: "
curl -s http://localhost/modules.json | jq empty >/dev/null 2>&1 && echo "‚úÖ Valid JSON" || echo "‚ùå Invalid/Missing"
echo ""

# File system checks
echo "üìÅ FILE SYSTEM"
printf "Web directory: "
test -d /var/www/infotecha.ru && echo "‚úÖ Exists" || echo "‚ùå Missing"

printf "Index file: "
test -f /var/www/infotecha.ru/index.html && echo "‚úÖ Exists" || echo "‚ùå Missing"

printf "modules.json: "
test -f /var/www/infotecha.ru/modules.json && echo "‚úÖ Exists" || echo "‚ùå Missing"

printf "Backup directory: "
test -d /var/www/infotecha.ru/backups && echo "‚úÖ Exists" || echo "‚ùå Missing"
echo ""

# Recent errors
echo "üö® RECENT ERRORS (last 10)"
grep -h "ERROR\|CRITICAL\|WARN" /var/www/infotecha.ru/logs/*.log 2>/dev/null | tail -10 | while read line; do
    echo "  $line"
done

if ! grep -h "ERROR\|CRITICAL\|WARN" /var/www/infotecha.ru/logs/*.log >/dev/null 2>&1; then
    echo "  No recent errors found ‚úÖ"
fi
echo ""

# SSL certificate status
echo "üîê SSL CERTIFICATE"
if [ -d "/etc/letsencrypt/live/infotecha.ru" ]; then
    expiry_date=$(openssl x509 -in /etc/letsencrypt/live/infotecha.ru/cert.pem -noout -enddate 2>/dev/null | cut -d= -f2)
    if [ -n "$expiry_date" ]; then
        expiry_epoch=$(date -d "$expiry_date" +%s 2>/dev/null)
        current_epoch=$(date +%s)
        days_until_expiry=$(( (expiry_epoch - current_epoch) / 86400 ))
        
        if [ "$days_until_expiry" -gt 30 ]; then
            echo "SSL certificate: ‚úÖ Valid for $days_until_expiry days"
        elif [ "$days_until_expiry" -gt 0 ]; then
            echo "SSL certificate: ‚ö†Ô∏è Expires in $days_until_expiry days"
        else
            echo "SSL certificate: ‚ùå EXPIRED"
        fi
    else
        echo "SSL certificate: ‚ùå Could not read certificate"
    fi
else
    echo "SSL certificate: ‚ùå Not found"
fi
echo ""

echo "üèÅ Diagnosis completed. Check items marked with ‚ùå for issues."
EOF

sudo chmod +x /opt/infotecha/scripts/quick-diagnosis.sh
sudo chown deploy-user:deploy-user /opt/infotecha/scripts/quick-diagnosis.sh
```

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
test -f /opt/infotecha/docs/disaster-recovery-plan.md && echo "‚úÖ Recovery plan exists"

# –¢–µ—Å—Ç —Å–∫—Ä–∏–ø—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
sudo /opt/infotecha/scripts/quick-diagnosis.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
ls -la /opt/infotecha/scripts/ | grep -E "(backup|monitor|diagnosis|deploy)"

# –°–∏–º—É–ª—è—Ü–∏—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ —Å–±–æ—è (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Apache)
sudo systemctl stop apache2
sleep 5
curl -I http://localhost || echo "Expected failure - Apache stopped"
sudo systemctl start apache2
curl -I http://localhost && echo "‚úÖ Recovery successful"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ñ—É—Ä–Ω–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## –ò—Ç–æ–≥–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —ç—Ç–∞–ø–∞ 7

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo tee /opt/infotecha/scripts/validate-monitoring.sh > /dev/null << 'EOF'
#!/bin/bash

echo "üîç InfoTech.io Monitoring System Validation"
echo "==========================================="

TESTS_PASSED=0
TESTS_TOTAL=0

run_test() {
    local test_name="$1"
    local test_command="$2"
    
    TESTS_TOTAL=$((TESTS_TOTAL + 1))
    printf "%-50s" "$test_name"
    
    if eval "$test_command" &>/dev/null; then
        echo "‚úÖ PASS"
        TESTS_PASSED=$((TESTS_PASSED + 1))
    else
        echo "‚ùå FAIL"
    fi
}

echo ""
echo "üîß Monitoring Scripts"
echo "--------------------"

run_test "System monitor script exists" "test -x /opt/infotecha/scripts/system-monitor.sh"
run_test "Backup script exists" "test -x /opt/infotecha/scripts/backup.sh"
run_test "Quick diagnosis script exists" "test -x /opt/infotecha/scripts/quick-diagnosis.sh"
run_test "Test backup script exists" "test -x /opt/infotecha/scripts/test-backup.sh"

echo ""
echo "üìã Cron Jobs"
echo "------------"

run_test "System monitoring cron configured" "crontab -u deploy-user -l | grep -q system-monitor"
run_test "Backup cron configured" "crontab -u deploy-user -l | grep -q backup.sh"

echo ""
echo "üìÅ Directory Structure"
echo "---------------------"

run_test "Backup directory exists" "test -d /var/www/infotecha.ru/backups"
run_test "Logs directory writable" "test -w /var/www/infotecha.ru/logs"
run_test "Status file directory exists" "test -d $(dirname /opt/infotecha/status.json)"
run_test "Documentation directory exists" "test -d /opt/infotecha/docs"

echo ""
echo "üíæ Backup System"
echo "---------------"

# Create test backup
/opt/infotecha/scripts/backup.sh config >/dev/null 2>&1
run_test "Can create config backup" "find /var/www/infotecha.ru/backups/config -name '*.tar.gz' -mmin -5 | grep -q ."

# Test backup listing
run_test "Backup listing works" "/opt/infotecha/scripts/backup.sh list | grep -q 'config backups:'"

echo ""
echo "üìä Monitoring Functions"
echo "----------------------"

# Run system monitor (should complete without errors)
/opt/infotecha/scripts/system-monitor.sh monitor >/dev/null 2>&1
run_test "System monitor runs successfully" "test -f /opt/infotecha/status.json"

# Check status file content
run_test "Status file contains valid JSON" "jq empty /opt/infotecha/status.json 2>/dev/null"

echo ""
echo "üîç Diagnostic Tools"
echo "------------------"

# Test quick diagnosis
/opt/infotecha/scripts/quick-diagnosis.sh >/tmp/diagnosis-test.log 2>&1
run_test "Quick diagnosis runs" "test -f /tmp/diagnosis-test.log"
run_test "Diagnosis detects services" "grep -q 'SERVICE STATUS' /tmp/diagnosis-test.log"

echo ""
echo "üìã Documentation"
echo "---------------"

run_test "Disaster recovery plan exists" "test -f /opt/infotecha/docs/disaster-recovery-plan.md"
run_test "Plan contains emergency contacts" "grep -q 'admin@infotecha.ru' /opt/infotecha/docs/disaster-recovery-plan.md"
run_test "Plan contains recovery procedures" "grep -q '–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è' /opt/infotecha/docs/disaster-recovery-plan.md"

echo ""
echo "üéØ Results Summary"
echo "=================="
echo "Total tests: $TESTS_TOTAL"
echo "Passed: $TESTS_PASSED"
echo "Failed: $((TESTS_TOTAL - TESTS_PASSED))"

if [ $TESTS_PASSED -eq $TESTS_TOTAL ]; then
    echo ""
    echo "üéâ All monitoring systems are operational!"
    echo "Platform is ready for production monitoring."
else
    echo ""
    echo "‚ö†Ô∏è Some monitoring components need attention."
    echo "Review failed tests and fix issues before production."
fi

# Cleanup
rm -f /tmp/diagnosis-test.log
EOF

sudo chmod +x /opt/infotecha/scripts/validate-monitoring.sh
sudo chown deploy-user:deploy-user /opt/infotecha/scripts/validate-monitoring.sh

# –ó–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
echo "üéØ Running final monitoring system validation..."
sudo /opt/infotecha/scripts/validate-monitoring.sh
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ —ç—Ç–∞–ø–∞ 7:**
- ‚úÖ –í–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ UptimeRobot –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã  
- ‚úÖ –ü–ª–∞–Ω –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–∞–ø–∞ 7:**

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ InfoTech.io –≥–æ—Ç–æ–≤–∞ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ. –í–∫–ª—é—á–∞–µ—Ç:

- **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- **–ù–∞–¥–µ–∂–Ω—ã–µ –±—ç–∫–∞–ø—ã** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- **–ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –ª—é–±—ã—Ö —Ç–∏–ø–∞—Ö —Å–±–æ–µ–≤
- **–î–µ—Ç–∞–ª—å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ InfoTech.io –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!** üéâ